# captionary-api

## Project Overview
Our project is a take on the popular game Pictionary where there are two players, a prompt guesser and
a scribbler. We add in AI as a sort of middle man, inserting itself in between guesser and scribbler and
providing input to aid the guesser to converge at the ground truth prompt. This idea was based off of
[ScribbleDiffusion](https://scribblediffusion.com/) - so the guesser provides the text prompt and the
scribbler provides the sketch. 

We use Scribble Diffusion (which is fine tuned on ControlNet) for our base
game, and for providing feedback to the guesser on how close their guess is, we finetuned BLIP on
custom prompts and sketches. We used [BLIP](https://github.com/salesforce/BLIP) for this, since it is an image captioning model, so it can
provide feedback on the similarity between:
- the image generated by Scribble Diffusion, which takes the scribbler’s sketch as the sketch input,
and the guesser’s guess as the prompt
- and the original prompt that was given to the scribbler by the game on what to draw, like “bear”
or “lamp”.
This score feedback from BLIP is given to the human players, who must take it into account to progress in
the game and reach a common prompt. We successfully prototyped a local version of the game for this
project.

<img width="400" alt="image" src="https://user-images.githubusercontent.com/46091397/230384250-7991e58f-e2b9-49db-a835-48df5f279966.png">

The Model and Dataset is uploaded on HuggingFace for easy use!
- Model - https://huggingface.co/eeshclusive/captionary-BLIP
- Dataset - https://huggingface.co/datasets/eeshclusive/captionary-dataset

This repository only has the model + API code. The frontend code can be found [here](https://github.com/y1vonnef/captionary)

## Steps to Run

### Fine Tuning BLIP
The python notebook `blip-finetune.ipynb` goes through the entire processing of fine-tuning BLIP

### Flask App

Install requirements
```
pip install -r requirements.txt
```

Run Flask App
```
python app.py
```

## To Make a Request

call route `/score` with arguments `image_url` and `id`

where  
`image_url` is the URL for the image to be scored
`id` is the label ID to be checked against (for mappings - [label-id map](https://github.com/eeshashetty/captionary-api/blob/1b326137879a68b19ea77d81f22dd0c2eb601452/id_label_map.py))

returns `0` (no match) or `1` (match)

Example Request

```
GET localhost:8000/score?image_url=https://replicate.delivery/pbxt/NFSsdG1sVxqUOJrduzNnh8jmON5hKcZBjHYze1qTXNe52siQA/output_1.png&id=2
```

returns `1`
